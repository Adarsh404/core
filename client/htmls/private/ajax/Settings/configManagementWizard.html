<link rel="stylesheet" type="text/css" media="screen" href="css/wizardBg.css">
<style>
    /*custom font*/
    @import url(http://fonts.googleapis.com/css?family=Montserrat);

    /*form styles*/
    form {
        margin: 10px auto;
        position: relative;
    }

    /*Hide all except first fieldset*/
    form:not(:first-of-type) {
        display: none;
    }

    /*buttons*/
    form .action-button {
        width: 100px;
        background: #27AE60;
        font-weight: bold;
        color: white;
        border: 0 none;
        border-radius: 1px;
        cursor: pointer;
        padding: 10px 5px;
        margin: 10px 5px;
    }
    form .action-button:hover, #msform .action-button:focus {
        box-shadow: 0 0 0 2px white, 0 0 0 3px #27AE60;
    }
    /*headings*/
    .fs-title {
        font-size: 15px;
        text-transform: uppercase;
        color: #2C3E50;
        margin-bottom: 10px;
    }
    .fs-subtitle {
        font-weight: normal;
        font-size: 13px;
        color: #666;
        margin-bottom: 20px;
    }
    /*progressbar*/
    #progressbar {
        overflow: hidden;
        text-align: center;
        /*CSS counters to number the steps*/
        counter-reset: step;
        margin-top: 5px;
    }
    #progressbar li {
        list-style-type: none;
        font-size: 15px;
        width: 50%;
        float: left;
        position: relative;
    }
    #progressbar li:before {
        content: counter(step);
        counter-increment: step;
        width: 20px;
        line-height: 20px;
        display: block;
        font-size: 10px;
        color: #fff;
        background: #7d7676;
        border-radius: 3px;
        margin: 0 auto 5px auto;
    }
    /*progressbar connectors*/
    #progressbar li:after {
        content: '';
        width: 100%;
        height: 2px;
        background: #7d7676;
        position: absolute;
        left: -50%;
        top: 9px;
        z-index: -1; /*put it behind the numbers*/
    }
    #progressbar li:first-child:after {
        /*connector not needed before the first step*/
        content: none;
    }
    /*marking active/completed steps green*/
    /*The number of the step and the connector before it = green*/
    #progressbar li.active:before,  #progressbar li.active:after{
        background: #27AE60;
        color: white;
    }

    .content {
        margin:0 auto;
        padding: 10px;
    }
    a, a:hover {
        color:#7d7676;
        text-decoration: none;
    }
    .green-btn {
        background-color: #5cb85c!important;
        color:#fff!important;
    }
</style>
<!-- multistep form -->

<!-- progressbar -->
<div class="wizardFlow">
</div>
<!-- fieldsets -->
<div class="content">
    <form action="" id="myForm22">
        <div class="widget-box">
            <div class="widget-header">
                <h4 class="widget-margin" style="color:black;">New Configuration Management</h4>
            </div>
            <div class="widget-body">
                <div class="widget-main" style="height:500px">
                    <div class="jarviswidget" data-widget-editbutton="false" data-widget-custombutton="false">
                        <div>
                            <!-- widget content -->
                            <div class="col-lg-6 col-md-6">
                                <label for="">Name:<span class="control-label redSpan">&nbsp;*</span></label>
                                <input name="ctl00$MainContent$orgname" value="" id="configname" class="form-control" type="text"  cdata="catalyst" unique="true"  cat-validation="required,max15" uniqueconditionedby="configname">
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <label for="name">User Name:<span class="control-label redSpan">&nbsp;*</span></label>
                                <input name="ctl00$MainContent$orgname" value="" id="loginname" class="form-control" type="text"  cdata="catalyst"  cat-validation="required">
                            </div>
                            <hr>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <label for="link">URL:<span class="control-label redSpan">&nbsp;*</span></label>
                                <input type="text" unique="true" uniqueconditionedbyUrl="url" name="ctl00$MainContent$orgname" value="" id="url" class="chefUrl form-control" type="url"  name="website"  cdata="catalyst"  cat-validation="required,urlcheck">
                            </div>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <label for="name">Organization:<span class="control-label redSpan">&nbsp;*</span></label>
                                <select id="orgname" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100 form-control" sourcepath="1" datapath="masterjson.rows.row" valuelinkfield="costcode" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                </select>
                            </div>
                            <hr/>
                            <input type="hidden" name="ctl00$MainContent$orgname" value="chef" id="configType" class="form-control"  cdata="catalyst"/>
                            <div class="col-lg-6 col-md-6 margintop20" id="frmconfigmanagement">
                                <div class="smart-forms">
                                    <label>User Pem File:<span class="control-label redSpan">&nbsp;*</span></label>
                                    <label for="userpemfile" class="field file">
                                        <div class="imgdiv" value="1"></div>
                                        <span class="button btn-primary">Browse</span><input id="userpemfile" keyfield="configname" type="file" onchange="this.nextSibling.value = this.value"  cdata="catalyst" class="gui-file" cat-validation="required"><input type="text" readonly="" class="pemFile gui-input">
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <div class="smart-forms" id="knifeFile">
                                    <label>Knife.rb File:<span class="control-label redSpan">&nbsp;*</span></label>
                                    <label for="kniferbfile" class="field file">
                                        <div class="imgdiv" value="1"></div>
                                        <span class="button btn-primary">Browse</span><input id="kniferbfile" keyfield="configname" type="file" onchange="this.nextSibling.value = this.value" class="gui-file"  cdata="catalyst" cat-validation="required"><input type="text" readonly="" class="knifeFile gui-input">
                                        <input id="folderpath"  cdata="catalyst" type="text" value="" style="display:none"/>
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <div class="smart-forms">
                                    <label>Validator Pem File:</label>
                                    <label for="validatorpemfile" class="field file">
                                        <div class="imgdiv" value="1"></div>
                                        <span class="button btn-primary">Browse</span><input id="validatorpemfile" keyfield="configname" type="file" onchange="this.nextSibling.value = this.value"  cdata="catalyst" class="gui-file"><input type="text" readonly="" class="gui-input">
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <div class="smart-forms">
                                    <label>Key File:</label>
                                    <label for="validatorpemfile" class="field file">
                                        <div class="imgdiv" value="1"></div>
                                        <span class="button btn-primary">Browse</span><input id="encryption" keyfield="configname" type="file" onchange="this.nextSibling.value = this.value"  cdata="catalyst" class="gui-file"><input type="text" readonly="" class="gui-input">
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 margintop20">
                                <div class="smart-forms">
                                    <label>Template File:</label>
                                    <label for="validatorpemfile" class="field file">
                                        <div class="imgdiv" value="1"></div>
                                        <span class="button btn-primary">Browse</span><input id="template" keyfield="configname" type="file" onchange="this.nextSibling.value = this.value"  cdata="catalyst" class="gui-file"><input type="text" readonly="" class="gui-input">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="widget-toolbox clearfix">
                <div class="btn-group pull-right">
                 <button name="next1" id="saveBg" style="margin-right:11px;" class="saveFormWizard btn btn-primary"><i class="ace-icon fa fa-check bigger-110"></i>&nbsp;Save</i></button>
                 <input type="button" disabled="disabled" name="next1" id="next1" class="nextFormWizard btn btn-primary" value="Next"/>
              </div>
            </div>
        </div>
    </form>
</div>

<script>
    //jQuery time
    orgNameForSetup = $('#orgDropdown option:selected').attr('rowid');
    orgIdForSetup = $('#orgDropdown option:selected').val();
    var $option = $('<option></option>').val(orgNameForSetup).attr('rowid',orgIdForSetup).html(orgNameForSetup);
    $('#orgname').append($option);
    function bindChange_importPemFile() {
        $('input[type="file"]').off('change').on('change', function() {
            $(this).next().val(this.files[0].name);
            $(this).next().next().val($(this).val());
        });
    }
    $(document).ready(function(e) {
        //api call for getting the status of wizard
        var wizardStepsConfig = $('<ol id="configWizard" class="bwizard-steps clearfix clickable"><li aria-selected="true" id="chefCreate" class="active btn-2 chefCreate" style="z-index: 4;"><span class="label badge-inverse">1</span><a href="ajax/Settings/configManagementWizard.html" class="hidden-phone">Create Chef Server</a><a href="ajax/Settings/configManagementWizard.html" class="hidden-phone"><small></small></a></li><li aria-selected="false" style="z-index: 3;" id="envCreate" class="btn-3 envCreate"><span class="label">2</span><a href="ajax/Settings/envWizard.html" class="hidden-phone">Create Environment</a><a href="ajax/Settings/envWizard.html" class="hidden-phone"></a><a href="ajax/Settings/envWizard.html" class="hidden-phone"></a></li></ol>');
        $('.wizardFlow').append(wizardStepsConfig);
        function getConfigValues() {
            $.get('/d4dMasters/readmasterjsonnew/10', function(data) {
                for(var i =0;i<data.length;i++){
                    if(selectedDropdownValue === data[i].orgname_rowid[0]){
                        $('#myForm22').find('input#configname').val(data[i].configname).attr('disabled','disabled');
                        $('#myForm22').find('input#loginname').val(data[i].loginname).attr('disabled','disabled');
                        $('#myForm22').find('input.chefUrl').val(data[i].url).attr('disabled','disabled');
                        var $optionOrgName = $('<option></option>').val(data[i].orgname[0]).attr('rowid',data[i].orgname_rowid[0]).html(data[i].orgname[0]);
                        $('#myForm22').find('select#orgname').append($optionOrgName).attr('disabled','disabled');
                        bindChange_importPemFile();
                        var $pemFileLocation = $('#frmconfigmanagement');
                        $pemFileLocation.find('input.pemFile').val(data[i].userpemfile_filename);
                        var $knifeFileLocation = $('#knifeFile');
                        $knifeFileLocation.find('input.knifeFile').val(data[i].kniferbfile_filename);
                        $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                    }
                }
            });
        }

        $('.btn-2 a').click(function(e) {
            e.preventDefault();
            clicked = false;
            $('.contentSetting').load(this.getAttribute('href'));
            
        });
        $('.btn-3 a').click(function(e) {
            e.preventDefault();
            $('.btn-2 a').parent('.bwizard-steps li').removeClass('active');
            $(this).parent('.bwizard-steps li').addClass('active');
            $('.content').load(this.getAttribute('href'));
        });
        if(clicked){
            $.get('/setting-wizard/org/' + orgIdForSetup, function(data) {
            if (data.currentStep.name === 'Config Management') {
                if (data.currentStep.nestedSteps) {
                    var nestedSteps = data.currentStep.nestedSteps;
                    if (nestedSteps[0].name === 'ChefServer' && nestedSteps[0].isCompleted === true && nestedSteps[1].name === 'Environment' && nestedSteps[1].isCompleted === false) {
                        $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                        $('.contentSetting').find('ol li#envCreate').addClass('active');
                        $('.content').load('ajax/Settings/envWizard.html');
                    } else {

                    }
                }
            } else {
                getConfigValues();
                $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                $('.btn-3 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
            }
        });    
        } else {
            getConfigValues();
        }
        
        $('#wizardActionListLoader').hide();
    });
    
    var current_fs, next_fs, previous_fs; //fieldsets
    var left, opacity, scale; //fieldset properties which we will animate
    var animating; //flag to prevent quick multi-click glitches
    

    function setfolderpath(){
        var folderpath = '/' + $('#loginname').val() + "/.chef/";
        $('#folderpath').val(folderpath);
    }

    $('#myForm22').find('input:text').keyup(function() {
        if($('#configname').val() != "" && $('#loginname').val() != "" && $('.chefUrl').val() != "") {
           $('#nextChef').removeAttr('disabled');
        } else {
           $('#nextChef').attr('disabled', true);   
        }
    });

    $('#myForm22').submit(function() {
        if(validateForm()) {setfolderpath(); saveform('10');};
        return false;
    });

    $(".nextFormWizard").click(function(){
        $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
        $('.contentSetting').find('ol li#envCreate').addClass('active');
        $('.content').load('ajax/Settings/envWizard.html');
    });
</script>