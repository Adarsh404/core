<div class="bgContent">
   <form action="" id="myForm3" class="content">
      <div class="widget-box">
         <div class="widget-header">
            <h4 class="widget-margin" style="color:black;">Create Project</h4>
         </div>
         <div class="widget-body">
            <div class="widget-main" style="min-height:200px">
               <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                <div>
                  <div class="widget-body no-padding">
                     <div class="col-lg-6 col-md-6">
                        <label for="name">Name:<span class="control-label redSpan">&nbsp;*</span></label>
                        <label id="msgOrgName" style="display:none;color:red;float:right;">Required</label>
                        <br>
                        <input autofocus name="ctl00$MainContent$orgname" value="" id="projectname" class="form-control" type="text"  cdata="catalyst" cat-validation="required,nospecial,max15,nospace"  unique="true"  uniqueconditionedby="projectname,orgname,productgroupname">
                     </div>
                     <div class="col-lg-6 col-md-6">
                        <label for="name">Description:</label>
                        <input name="ctl00$MainContent$orgname" value="" id="description" class="form-control" type="text"  cdata="catalyst" maxlength="50">
                     </div>
                     <div class="col-lg-6 col-md-6" style="margin-top:25px;">
                        <label for="">Organization:<span class="control-label redSpan">&nbsp;*</span></label>
                        <select id="orgname" class="chooseOrganization form-control width-100" linkedfields="['productgroupname','environmentname','teamname']"  cdata="catalyst" cat-validation="required">
                        </select>
                     </div>
                     <div class="col-lg-6 col-md-6" style="margin-top:25px;">
                        <label for="">Business Group:<span class="control-label redSpan">&nbsp;*</span></label>
                        <select id="productgroupname" class="chooseBG form-control width-100" linkedto="orgname"  cdata="catalyst" cat-validation="required">
                        </select>
                     </div>
                     <div class="col-lg-6 col-md-6 smart-form hidden" style="margin-top:25px;">
                        <label for="category">Environments:</label>
                        <div  id="environmentname" multiselect="multiselect" datatype="select" sourcepath="3" datapath="masterjson.rows.row"  linkedto="orgname" class="input-group from-control col-md-12 widthBox" cdata="catalyst">
                        </div>
                     </div>
                     <div class="col-lg-6 col-md-6 hidden">
                        <a style="cursor:pointer;" data-toggle="modal" data-backdrop="false" id="repoanchorDetails" href="#repodetailsModal"> <img title="Add Repository Details" data-placement="top" rel="tooltip" class="addrepoDetails" style="float:right;margin-top:20px;" src="img/add.png"></a>
                        <label style="float:left;margin-top:20px;">Repositories Details :</label>
                        <div class="table-responsive table-div">
                           <table id="tablerepositoryDetails" class="table table-striped table-bordered table-hover dataTable" style="border:1px solid #eeeeee !important; text-align:center;font-size:12px;margin-top:45px;" width="100%" cellpadding="5px">
                              <thead>
                                 <tr class="rowCustomStyle" style="font-weight:bold;">
                                    <td style="color:#fff;background-color: #2c3742; width:35%">Repository</td>
                                    <td style="color:#fff;background-color: #2c3742;">Name</td>
                                    <td style="color:#fff;background-color: #2c3742; width:10%">Action</td>
                                 </tr>
                              </thead>
                              <tbody id="repoDeployTbody">
                              </tbody>
                           </table>
                        </div>
                     </div>
                     <div class="col-lg-6 col-md-6 hidden">
                        <label for="name">Repository Details:</label>
                        <input autofocus name="ctl00$MainContent$orgname" value="" id="repositories" class="form-control" type="text"  cdata="catalyst">
                     </div>
                     <!-- end widget content -->
                  </div>
                </div>
               </div>
            </div>
         </div>
      </div>
      <div class="btn-group pull-right">
         <button name="next3" id="next3" class="nextBG btn btn-primary btn-mini">Next</button>
      </div>
   </form>
</div>

<script>
//to get the businessGroupname corresponding to the organisation.
function getBusinessGroupName(orgId) {
    $.get('/d4dMasters/readmasterjsonnew/2', function(data) {
        for (var i = 0; i < data.length; i++) {
            if (data[i].orgname_rowid[0] === orgId) {
                var $option = $('<option></option>').val(data[i].productgroupname).attr('rowid', data[i].rowid).html(data[i].productgroupname);
                $('#productgroupname').append($option);
            }
        }
    });
}
//if orgId already available
if (selectedDropdownValue) {
    $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
    $('.btn-3 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
    var $optionSelect = $('<option></option').val(orgForBg).attr('rowid', selectedDropdownValue).html(orgForBg);
    $('#orgname').append($optionSelect);
    getBusinessGroupName(selectedDropdownValue);
} else {
    orgNameForSetup = $('#orgDropdown option:last').attr('rowid');
    orgIdForSetup = $('#orgDropdown option:last').val();
    $('#orgDropdown option:last').attr('selected', 'selected')
    var $optionSelect = $('<option></option').val(orgNameForSetup).attr('rowid', orgIdForSetup).html(orgNameForSetup);
    $('#orgname').append($optionSelect);
    $('#orgname').change(function(e) {
        $('#productgroupname').empty();
        var orgValue = $('#orgname option:selected').attr('rowid');
        orgValueSelected = $('#orgname option:selected').attr('rowid');
        getBusinessGroupName(orgIdForSetup)
    });
}
$('#orgname').trigger('change');
var repositories = {
    nexus: [],
    docker: []
};
$('#repositories').val(JSON.stringify(repositories));
//form submit for project.
$('#myForm3').submit(function() {
    $(this).validate();
    if ($(this).valid) {
        if (!saveform('4')) {
            $('#wizardActionListLoader').show();
            $('#configManagement a').trigger('click');
            $('#startConfig a, #orgConfiguration a').addClass('green-btn').removeClass('process-btn');
            $('.wizardFlow').empty();
            return false;
        }
    } else {
        alert('invalid valid form submitted'); // for demo
    }
    return false; // for demo
});

$(".nextBG").click(function() {
    toastr.success('Step 1 - Org Setup Completed');
    $('#createNew').removeClass('hidden');
    $('#cancelWizard').addClass('hidden');
});
</script>