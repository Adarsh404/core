<form action="" id="myForm22">
   <div class="widget-box">
      <div class="widget-header">
         <h4 class="widget-margin" style="color:black;">Create VmImages</h4>
      </div>
      <div class="widget-body">
         <div class="widget-main" style="min-height:200px">
            <div class="jarviswidget" data-widget-editbutton="false" data-widget-custombutton="false">
               <div>
                  <!-- widget content -->
                  <div class="widget-body no-padding">
                     
                        <div class="col-lg-6">
                           <label for="">Name:<span class="control-label redSpan">&nbsp;*</span></label>
                           <input name="ctl00$MainContent$orgname" placeholder="Please Enter Image Name" id="name" class="form-control" type="text"  cdata="catalyst" cat-validation="required,max15">
                        </div>
                        <div class="col-lg-6">
                           <label for="name">Organization Name:<span class="control-label redSpan">&nbsp;*</span></label>
                           <select id="orgId" name="orgId" unique="true" uniqueconditionedby="orgname"  class="form-control chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                              <option value="">Select Organization</option>
                           </select>
                        </div>
                     
                     
                        <div class="col-lg-6 margintop20">
                           <label for="name">Choose Provider:<span class="control-label redSpan">&nbsp;*</span></label>
                           <select id="providerId" disabled="disabled" unique="true" uniqueconditionedby="orgname"  class="form-control chooseOrganization width-100" datapath="masterjson.rows.row" valuelinkfield="costcode" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                              <option value="">Choose Provider</option>
                           </select>
                        </div>
                        <div class="col-lg-6 margintop20">
                           <label for="name">Operating System:<span class="control-label redSpan">&nbsp;*</span></label>
                           <select id="osType" unique="true" uniqueconditionedby="orgname"  class="form-control chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                              <option value="">Select OS</option>
                           </select>
                        </div>
                     
                     
                        <div class="col-lg-6 margintop20">
                           <label for=""> Image ID:<span class="control-label redSpan">&nbsp;*</span></label>
                           <input name="ctl00$MainContent$orgname" Placeholder="Enter Image Identifier" id="imageidentifire" class="form-control" type="text"  cdata="catalyst" cat-validation="required">
                        </div>
                        <div class="col-lg-6 margintop20">
                           <label for=""> Admin  User Name:<span class="control-label redSpan">&nbsp;*</span></label>
                           <input name="ctl00$MainContent$orgname" Placeholder="Enter The Admin UserName" id="UserName" class="form-control" type="text"  cdata="catalyst" cat-validation="required,max15">
                        </div>
                        <div class="col-lg-6 forazurepassword margintop20">
                           <label for=""> Admin  Password:</label>
                           <input name="ctl00$MainContent$orgname" Placeholder="Enter The Admin Password" id="password" class="form-control" type="password" autocomplete="false"  cdata="catalyst">
                        </div>
                  </div>
                  <!-- end widget content -->
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="btn-group pull-right">
      <button  name="nextChef" id="nextChef" class="nextChef action-button" value="Next">Next</button>
   </div>
</form>
<script>
    //jQuery time
    var current_fs, next_fs, previous_fs; //fieldsets
    var left, opacity, scale; //fieldset properties which we will animate
    var animating; //flag to prevent quick multi-click glitches

    var $option = $('<option></option>').val(orgIdForSetup).html(orgNameForSetup);
    $('#orgId').append($option);
    $("#orgId").on('change', function(e) {
        getProviderList($("#orgId").val());
    });    

function appendLoader() {
    removeLoader();
    $("form[id*='myForm']").find("div.pull-right > button").attr('disabled', 'disabled').parent().prepend('<label id="masterssavespinner" class="" style="float:left;"><img  style="margin-left:5px;margin-right:25px;margin-top:8px;" src="img/select2-spinner.gif" /></label>');
}

function removeLoader() {
    $('#masterssavespinner').remove();
    $("form[id*='myForm']").find("div.pull-right > button").removeAttr('disabled');
}

function getProviderList(_val) {

    $.ajax({
        type: "GET",
        url: "/allproviders/list",
        success: function(data) {
            var str = "";
            for (var key in data) {
                if (data.hasOwnProperty(key)) {

                    for (var i = 0; i < data[key].length; i++) {
                        if (_val == data[key][i].orgId) {
                            if (key === "awsProviders") {
                                str = str + '<option value="' + data[key][i]._id + '" secretKey="' + data[key][i].secretKey + '" accessKey="' + data[key][i].accessKey + '" providerType="' + data[key][i].providerType + '">' + data[key][i].providerName + '</option>';
                            } else if (key === "openstackProviders") {
                                str += '<option value="' + data[key][i]._id + '" username="' + data[key][i].userName + '" password="' + data[key][i].password + '" providerType="' + data[key][i].providerType + '">' + data[key][i].providerName + '</option>';
                            } else if (key === "vmwareProviders") {
                                str += '<option value="' + data[key][i]._id + '" username="' + data[key][i].userName + '" password="' + data[key][i].password + '" providerType="' + data[key][i].providerType + '">' + data[key][i].providerName + '</option>';
                            } else if (key === "hpPlublicCloudProviders") {
                                str += '<option value="' + data[key][i]._id + '" username="' + data[key][i].userName + '" password="' + data[key][i].password + '" providerType="' + data[key][i].providerType + '">' + data[key][i].providerName + '</option>';
                            } else if (key === "azureProviders") {
                                str += '<option value="' + data[key][i]._id + '" subscriptionId="' + data[key][i].subscriptionId + '" storageAccount="' + data[key][i].storageAccount + '" providerType="' + data[key][i].providerType + '">' + data[key][i].providerName + '</option>';
                            }
                        }
                    }
                }
            }
            
            $('#providerId').html(str);
            $('#providerId option:eq(0)').attr('selected', 'selected');
            $('#providerId').prop("disabled", false);

            if ($('#providerId').attr('answer')) {
                $('#providerId').val($('#providerId').attr('answer'));
            }
            

            $('#osType').on('change',function(){
              var ostype = $('#osType').find("option:selected").val();
              if($('#osType').val() == 'Windows'){
                  $('.forazurepassword').find('#password').attr('cat-validation', 'required,min8');
                  $('.forazurepassword label').html('Admin  Password:').append('<span class="control-label redSpan">&nbsp;*</span>');
              }else{
                  $('.forazurepassword label').html('Admin  Password:');
                  $('.forazurepassword').find('#password').removeAttr('cat-validation');
              }
            });
        }

    });
}

function saveImageForm() {
    appendLoader();
    var imageIdentifier = $('#imageidentifire').val().trim(),
        name = $('#name').val().trim(),
        osName = $('#osType').val().trim(),
        providerId = $('#providerId').val().trim(),
        url, osType = $('#osType').find('option:selected').attr('ostype'),
        userName = $('#UserName').val(),
        orgId = $('#orgId').val().trim();
    var pt = $('#providerId').find('option:selected').attr('providertype');
    //alert(orgId);

    var password = $('#password').val().trim();

    if (imageIdentifier && providerId && osType && name && osName && userName && orgId) {
        appendLoader();
        if (!UtilityMethods.getIdFromURL()) {
            url = "/vmimages";
        } 

        //debugger;
        $.ajax({
            method: "POST",
            url: url,
            data: {
                "providerId": providerId,
                "osType": osType,
                "name": name,
                "imageIdentifier": imageIdentifier,
                "osName": osName,
                "userName": userName,
                "orgId": orgId,
                "providertype": pt,
                "password": password
            },
            success: function(data, success) {
                if (data != 500) {
                    if ($('#btncancel').length) {
                        $('#btncancel').click();
                    }
                    removeLoader();
                } else {
                    removeLoader();
                    alert(data.toString());
                }
            },
            error: function(jqxhr) {
                removeLoader();
                bootbox.alert(jqxhr.responseText);
            },
            failure: function(data) {
                bootbox.alert(data.responseText);
                removeLoader();
            }
        });

    }
}

function populateOSList() {
    $.ajax({
        type: "GET",
        url: "/vmimages/os/type/all/list",
        success: function(data) {
            data = typeof data == "string" ? JSON.parse(data) : data;
            var str = ' <option value="">Select OS Type</option>',
                len = data.length;
            for (var i = 0; i < len; i++) {
                str = str + '<option value="' + data[i]["os_name"] + '" ostype="' + data[i]["osType"] + '">' + data[i]["os_name"] + '</option>';

            }
            $('#osType').html(str);
            if ($('#osType').attr('answer')) {
                $('#osType').val($('#osType').attr('answer'));
            }
        },
        failure: function(data) {
            alert(data.toString());
        }
    });
}

var UtilityMethods = {
    initTooltip: function() {
        var $tool = $("[rel=tooltip]");
        if ($tool.length) {
            $tool.tooltip();
        }
    },
    getRandomNumber: function() {
        return parseInt(Math.random() * 10000000000);
    },
    getIdFromURL: function() {
        var options = location.toString().split('?');
        return options.length > 1 ? (options[1] !== "new" ? options[1] : "") : "";
    }
};

$(document).ready(function() {
    $("#name").focus();
    $('#myForm22').submit(function() {
        if (isFormValid()) {
            saveImageForm();
        } else {
        }
        return false; // for demo
    });
    populateOSList();
});


    $(".nextChef").click(function(){
        toastr.success('Step 3 - Provider Configuration Setup Completed');
        $('#devopsConfiguration a').trigger('click');
    });

    $(".previous").click(function(){
        if(animating) return false;
        animating = true;

        current_fs = $(this).parent();
        previous_fs = $(this).parent().prev();

        //de-activate current step on progressbar
        $("#progressbar li").eq($("form").index(current_fs)).removeClass("active");

        //show the previous fieldset
        previous_fs.show();
        //hide the current fieldset with style
        current_fs.animate({opacity: 0}, {
            step: function(now, mx) {
                //as the opacity of current_fs reduces to 0 - stored in "now"
                //1. scale previous_fs from 80% to 100%
                scale = 0.8 + (1 - now) * 0.2;
                //2. take current_fs to the right(50%) - from 0%
                left = ((1-now) * 50)+"%";
                //3. increase opacity of previous_fs to 1 as it moves in
                opacity = 1 - now;
                current_fs.css({'left': left});
                previous_fs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
            },
            duration: 800,
            complete: function(){
                current_fs.hide();
                animating = false;
            },
            //this comes from the custom easing plugin
            easing: 'easeInOutBack'
        });
    });
</script>